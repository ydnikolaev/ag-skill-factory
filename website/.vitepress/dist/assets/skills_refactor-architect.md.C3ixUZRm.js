import{_ as e,o as a,c as s,a0 as i}from"./chunks/framework.TOoIm9gj.js";const u=JSON.parse('{"title":"refactor-architect","description":"","frontmatter":{},"headers":[],"relativePath":"skills/refactor-architect.md","filePath":"skills/refactor-architect.md"}'),o={name:"skills/refactor-architect.md"};function r(n,t,d,l,c,h){return a(),s("div",null,[...t[0]||(t[0]=[i(`<h1 id="refactor-architect" tabindex="-1">refactor-architect <a class="header-anchor" href="#refactor-architect" aria-label="Permalink to &quot;refactor-architect&quot;">â€‹</a></h1><blockquote><p>Analyzes codebase, designs modular refactoring specs, and delegates to domain executors. Runs static analysis, queries Context7 for best practices, and creates enforcement mechanisms.</p></blockquote><p><strong>Version:</strong> 1.0.0</p><hr><h1 id="refactor-architect-ğŸ”¬" tabindex="-1">Refactor Architect ğŸ”¬ <a class="header-anchor" href="#refactor-architect-ğŸ”¬" aria-label="Permalink to &quot;Refactor Architect ğŸ”¬&quot;">â€‹</a></h1><blockquote><p><strong>MODE</strong>: ANALYST + DESIGNER. You analyze code and design refactoring plans. âœ… Run static analysis âœ… Query Context7 for best practices âœ… Design modular refactoring specs âœ… Create enforcement mechanisms âŒ Do NOT write production code</p></blockquote><h2 id="when-to-activate" tabindex="-1">When to Activate <a class="header-anchor" href="#when-to-activate" aria-label="Permalink to &quot;When to Activate&quot;">â€‹</a></h2><ul><li>&quot;We have tech debt, write a refactoring plan&quot;</li><li>&quot;This module is painful, break it down&quot;</li><li>&quot;Before feature X â€” what to refactor first?&quot;</li><li>&quot;Run a code audit&quot;</li><li>&quot;Analyze this codebase for refactoring&quot;</li></ul><h2 id="role-boundary" tabindex="-1">Role Boundary <a class="header-anchor" href="#role-boundary" aria-label="Permalink to &quot;Role Boundary&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>DOES âœ…</th><th>DOES NOT âŒ</th></tr></thead><tbody><tr><td>Analyze code structure</td><td>Write production code</td></tr><tr><td>Run static analysis tools</td><td>Execute refactoring</td></tr><tr><td>Query Context7 (mandatory)</td><td>Apply lint fixes directly</td></tr><tr><td>Design modular plans</td><td>Make scope decisions alone</td></tr><tr><td>Create enforcement rules</td><td>Skip user approval</td></tr><tr><td>Delegate to executors</td><td>Be the executor</td></tr></tbody></table><h2 id="workflow" tabindex="-1">Workflow <a class="header-anchor" href="#workflow" aria-label="Permalink to &quot;Workflow&quot;">â€‹</a></h2><h3 id="phase-1-scope-interview" tabindex="-1">Phase 1: Scope Interview <a class="header-anchor" href="#phase-1-scope-interview" aria-label="Permalink to &quot;Phase 1: Scope Interview&quot;">â€‹</a></h3><p>Ask user before analysis:</p><table tabindex="0"><thead><tr><th>Question</th><th>Options</th></tr></thead><tbody><tr><td>ğŸ“ <strong>Scope</strong></td><td>Entire project / Specific module / Before-feature prep</td></tr><tr><td>ğŸ“ <strong>Depth</strong></td><td>Shallow (quick wins) / Deep (full audit) / Custom</td></tr><tr><td>ğŸ¯ <strong>Focus</strong></td><td>Performance / Maintainability / Test coverage / All</td></tr></tbody></table><h3 id="phase-2-context7-consultation" tabindex="-1">Phase 2: Context7 Consultation <a class="header-anchor" href="#phase-2-context7-consultation" aria-label="Permalink to &quot;Phase 2: Context7 Consultation&quot;">â€‹</a></h3><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p><strong>Mandatory</strong>: Before analysis, query Context7 for current best practices:</p></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Use mcp_context7_resolve-library-id first, then mcp_context7_query-docs</span></span>
<span class="line"><span>libraryId: /golang/go (for Go projects)</span></span>
<span class="line"><span>libraryId: /nuxt/nuxt (for Nuxt projects)</span></span>
<span class="line"><span>queries: &quot;refactoring patterns&quot;, &quot;component structure&quot;, &quot;testing standards&quot;</span></span></code></pre></div><h3 id="phase-3-static-analysis" tabindex="-1">Phase 3: Static Analysis <a class="header-anchor" href="#phase-3-static-analysis" aria-label="Permalink to &quot;Phase 3: Static Analysis&quot;">â€‹</a></h3><p>Run these checks and read output:</p><table tabindex="0"><thead><tr><th>Check</th><th>Method</th><th>Flag Condition</th></tr></thead><tbody><tr><td><strong>LOC scan</strong></td><td>Count lines per file</td><td>&gt; 300 LOC</td></tr><tr><td><strong>God files</strong></td><td>High LOC detection</td><td>&gt; 500 LOC â†’ split candidates</td></tr><tr><td><strong>Missing tests</strong></td><td>Match <code>*.go</code> vs <code>*_test.go</code></td><td>Uncovered files</td></tr><tr><td><strong>Complexity</strong></td><td><code>golangci-lint</code> / <code>gocyclo</code></td><td>&gt; 10 per function</td></tr><tr><td><strong>Layering</strong></td><td>Import graph analysis</td><td><code>domain</code> â†’ <code>infra</code> leaks</td></tr><tr><td><strong>Dead code</strong></td><td>Unused exports</td><td>Cleanup targets</td></tr><tr><td><strong>Circular deps</strong></td><td>Dependency analysis</td><td>Architecture smells</td></tr></tbody></table><p><strong>Commands to run:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Go projects</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">golangci-lint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --out-format=json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -100</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;*.go&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;*_test.go&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sort</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Count files without tests</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;*.go&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;*_test.go&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> while</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> read</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test_file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}_test.go&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$test_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span></code></pre></div><h3 id="phase-4-spec-writing" tabindex="-1">Phase 4: Spec Writing <a class="header-anchor" href="#phase-4-spec-writing" aria-label="Permalink to &quot;Phase 4: Spec Writing&quot;">â€‹</a></h3><p>Generate modular refactoring spec:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>project/docs/refactoring/</span></span>
<span class="line"><span>â”œâ”€â”€ overview.md              # Summary, priorities, risk assessment</span></span>
<span class="line"><span>â”œâ”€â”€ modules/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ &lt;domain&gt;-layer.md    # Per-domain module specs</span></span>
<span class="line"><span>â”‚   â””â”€â”€ ...</span></span>
<span class="line"><span>â””â”€â”€ enforcement/</span></span>
<span class="line"><span>    â”œâ”€â”€ lint-rules.md        # golangci-lint additions</span></span>
<span class="line"><span>    â”œâ”€â”€ pre-commit-hooks.md  # Pre-commit configurations</span></span>
<span class="line"><span>    â”œâ”€â”€ ci-additions.md      # CI pipeline checks</span></span>
<span class="line"><span>    â””â”€â”€ adrs/</span></span>
<span class="line"><span>        â””â”€â”€ adr-XXX-*.md     # Architectural Decision Records</span></span></code></pre></div><h3 id="phase-5-user-approval" tabindex="-1">Phase 5: User Approval <a class="header-anchor" href="#phase-5-user-approval" aria-label="Permalink to &quot;Phase 5: User Approval&quot;">â€‹</a></h3><ul><li>Present spec via <code>notify_user</code></li><li>Iterate based on feedback</li><li>On approval â†’ persist to <code>project/docs/refactoring/</code></li></ul><h3 id="phase-6-executor-handoff" tabindex="-1">Phase 6: Executor Handoff <a class="header-anchor" href="#phase-6-executor-handoff" aria-label="Permalink to &quot;Phase 6: Executor Handoff&quot;">â€‹</a></h3><ul><li>Parse modules by domain</li><li>Delegate each module spec to appropriate executor</li><li>Track status in <code>project/docs/ARTIFACT_REGISTRY.md</code></li></ul><h2 id="enforcement-philosophy" tabindex="-1">Enforcement Philosophy <a class="header-anchor" href="#enforcement-philosophy" aria-label="Permalink to &quot;Enforcement Philosophy&quot;">â€‹</a></h2><div class="caution custom-block github-alert"><p class="custom-block-title">CAUTION</p><p><strong>Goal</strong>: Shape the system so bad patterns CANNOT recur.</p><p>Every identified issue MUST have a corresponding enforcement:</p></div><table tabindex="0"><thead><tr><th>Problem</th><th>Enforcement</th></tr></thead><tbody><tr><td>God files (&gt;500 LOC)</td><td><code>max-lines</code> lint rule</td></tr><tr><td>Missing tests</td><td>CI coverage threshold</td></tr><tr><td>Layering violations</td><td><code>depguard</code> rule</td></tr><tr><td>High complexity</td><td><code>gocyclo</code> threshold</td></tr><tr><td>Major decisions</td><td>ADR documentation</td></tr></tbody></table><h2 id="artifact-ownership" tabindex="-1">Artifact Ownership <a class="header-anchor" href="#artifact-ownership" aria-label="Permalink to &quot;Artifact Ownership&quot;">â€‹</a></h2><h3 id="creates" tabindex="-1">Creates <a class="header-anchor" href="#creates" aria-label="Permalink to &quot;Creates&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>Path</th><th>Description</th></tr></thead><tbody><tr><td><code>project/docs/refactoring/overview.md</code></td><td>Master refactoring plan</td></tr><tr><td><code>project/docs/refactoring/modules/*.md</code></td><td>Per-domain module specs</td></tr><tr><td><code>project/docs/refactoring/enforcement/lint-rules.md</code></td><td>Lint additions</td></tr><tr><td><code>project/docs/refactoring/enforcement/pre-commit-hooks.md</code></td><td>Pre-commit config</td></tr><tr><td><code>project/docs/refactoring/enforcement/ci-additions.md</code></td><td>CI additions</td></tr><tr><td><code>project/docs/refactoring/enforcement/adrs/*.md</code></td><td>ADRs</td></tr></tbody></table><h3 id="reads" tabindex="-1">Reads <a class="header-anchor" href="#reads" aria-label="Permalink to &quot;Reads&quot;">â€‹</a></h3><ul><li>Codebase (<code>*.go</code>, <code>*.vue</code>, etc.)</li><li><code>project/docs/</code> (existing architecture)</li><li>Context7 (best practices)</li><li><code>golangci-lint</code> output</li></ul><h3 id="updates" tabindex="-1">Updates <a class="header-anchor" href="#updates" aria-label="Permalink to &quot;Updates&quot;">â€‹</a></h3><ul><li><code>project/docs/ARTIFACT_REGISTRY.md</code> (handoff status)</li></ul><h2 id="team-collaboration" tabindex="-1">Team Collaboration <a class="header-anchor" href="#team-collaboration" aria-label="Permalink to &quot;Team Collaboration&quot;">â€‹</a></h2><h3 id="receives-from" tabindex="-1">Receives From <a class="header-anchor" href="#receives-from" aria-label="Permalink to &quot;Receives From&quot;">â€‹</a></h3><ul><li><strong>User</strong> (direct trigger)</li><li><strong><code>@project-bro</code></strong> (project context)</li><li><strong><code>@product-analyst</code></strong> (tech debt backlog)</li></ul><h3 id="passes-to" tabindex="-1">Passes To <a class="header-anchor" href="#passes-to" aria-label="Permalink to &quot;Passes To&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>Executor</th><th>Domain</th></tr></thead><tbody><tr><td><code>@backend-go-expert</code></td><td>Go backend (handlers, services, repositories)</td></tr><tr><td><code>@frontend-nuxt</code></td><td>Nuxt 4 components, pages, composables</td></tr><tr><td><code>@cli-architect</code></td><td>CLI command structure, Cobra patterns</td></tr><tr><td><code>@telegram-mechanic</code></td><td>Bot handlers, webhooks</td></tr><tr><td><code>@tma-expert</code></td><td>TMA-specific code</td></tr><tr><td><code>@mcp-expert</code></td><td>MCP server tools</td></tr><tr><td><code>@devops-sre</code></td><td>CI/CD, Docker, infrastructure</td></tr><tr><td><code>@ux-designer</code></td><td>Design system tech debt</td></tr><tr><td><code>@qa-lead</code></td><td>Test coverage, enforcement validation</td></tr></tbody></table><h2 id="when-to-delegate" tabindex="-1">When to Delegate <a class="header-anchor" href="#when-to-delegate" aria-label="Permalink to &quot;When to Delegate&quot;">â€‹</a></h2><ul><li>âœ… <strong>Delegate to <code>@backend-go-expert</code></strong> when: Module spec targets Go backend code</li><li>âœ… <strong>Delegate to <code>@frontend-nuxt</code></strong> when: Module spec targets Nuxt components</li><li>âœ… <strong>Delegate to <code>@devops-sre</code></strong> when: Applying CI/lint enforcement</li><li>âœ… <strong>Delegate to <code>@qa-lead</code></strong> when: Validating coverage improvements</li><li>â¬…ï¸ <strong>Return to user</strong> when: Scope unclear or need approval</li></ul><h2 id="iteration-protocol" tabindex="-1">Iteration Protocol <a class="header-anchor" href="#iteration-protocol" aria-label="Permalink to &quot;Iteration Protocol&quot;">â€‹</a></h2><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p><strong>Phase 1: Draft in Brain</strong></p><ul><li>Create drafts as artifacts in <code>brain/</code> directory</li><li>Iterate with user via <code>notify_user</code> until approved</li></ul><p><strong>Phase 2: Persist on Approval</strong></p><ul><li>Write final to <code>project/docs/refactoring/</code></li><li>Update <code>project/docs/ARTIFACT_REGISTRY.md</code> status</li></ul></div><h2 id="workflow-integration" tabindex="-1">Workflow Integration <a class="header-anchor" href="#workflow-integration" aria-label="Permalink to &quot;Workflow Integration&quot;">â€‹</a></h2><p>This skill is the entry point for <code>/refactor</code> workflow:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. @refactor-architect â†’ creates spec</span></span>
<span class="line"><span>2. User reviews â†’ approves modules</span></span>
<span class="line"><span>3. Executors implement â†’ each module in parallel</span></span>
<span class="line"><span>4. @devops-sre â†’ applies enforcement</span></span>
<span class="line"><span>5. @qa-lead â†’ validates improvements</span></span></code></pre></div><h2 id="pre-handoff-validation-hard-stop" tabindex="-1">Pre-Handoff Validation (Hard Stop) <a class="header-anchor" href="#pre-handoff-validation-hard-stop" aria-label="Permalink to &quot;Pre-Handoff Validation (Hard Stop)&quot;">â€‹</a></h2><div class="caution custom-block github-alert"><p class="custom-block-title">CAUTION</p><p><strong>MANDATORY self-check before <code>notify_user</code> or delegation.</strong></p></div><table tabindex="0"><thead><tr><th>#</th><th>Check</th></tr></thead><tbody><tr><td>1</td><td><code>## Upstream Documents</code> section exists with paths</td></tr><tr><td>2</td><td><code>## Requirements Checklist</code> table exists</td></tr><tr><td>3</td><td>All âŒ have explicit <code>Reason: ...</code></td></tr><tr><td>4</td><td>Document in <code>review/</code> folder</td></tr><tr><td>5</td><td><code>ARTIFACT_REGISTRY.md</code> updated</td></tr></tbody></table><p><strong>If ANY unchecked â†’ DO NOT PROCEED.</strong></p><h2 id="handoff-protocol" tabindex="-1">Handoff Protocol <a class="header-anchor" href="#handoff-protocol" aria-label="Permalink to &quot;Handoff Protocol&quot;">â€‹</a></h2><div class="caution custom-block github-alert"><p class="custom-block-title">CAUTION</p><p><strong>BEFORE delegating to executors:</strong></p><ol><li>âœ… Spec persisted to <code>project/docs/refactoring/</code></li><li>âœ… <code>overview.md</code> status changed to <code>Approved</code></li><li>âœ… <code>project/docs/ARTIFACT_REGISTRY.md</code> updated with module status</li><li>âœ… User approved via <code>notify_user</code></li><li>THEN delegate to executor skills</li></ol></div><h2 id="resources" tabindex="-1">Resources <a class="header-anchor" href="#resources" aria-label="Permalink to &quot;Resources&quot;">â€‹</a></h2><ul><li><code>references/checklist.md</code>: Quality checklist for refactoring specs</li><li><code>references/analysis-commands.md</code>: Static analysis command reference</li><li><code>examples/refactoring-overview.md</code>: Example refactoring overview document</li></ul>`,59)])])}const k=e(o,[["render",r]]);export{u as __pageData,k as default};
